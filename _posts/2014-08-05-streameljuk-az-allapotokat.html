---
layout: post
title: Streameljük az állapotokat
date: '2014-08-05T13:25:00.000-07:00'
author: Stryker
tags: 
modified_time: '2014-08-05T13:25:31.613-07:00'
---

Ezt a bejegyzést már jó ideje megakartam már írni,de valahogy sosem vett rá a lélek.<br />Ebben a bejegyzésben bemutatom az állapotgépemet, amit csináltam még anno a játék motoromhoz, mert elég érdekesen csináltam meg, mivel Stream-et használtam hozzá. Előbb viszont tisztázok néhány fogalmat.<br /><br /><br /><b><span style="font-size: large;">Állapotgép</span></b><div><b><span style="font-size: large;"></span></b>Az állapotgép, ahogy a nevéből is kiderül egy olyan gép, aminek állapotai vannak. Ezek az állapotok között klasszikus értelemben van kezdő, aktuális és végállapot. Az állapotgép feladata, hogy események hatására egyik állapotból átmenjen egy másikba. A gép célja, hogy a kezdőállapotból eljusson a végállapotba.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://odetocode.com/aimages/workflow/7/figure1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://odetocode.com/aimages/workflow/7/figure1.png" height="236" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;">Ez egy egyszerű kapcsolónak a diagramja.</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Jól látszik az ábrából, hogy 2 állapot van, amikbe lehetünk. Kezdő állapot és végállapot nincs, de egy igazi rendszernél biztos a kikapcsolt állapot lenne a kezdő állapot. Események itt a kapcsoló használata, ami előidézi, hogy állapot váltás menjen végbe.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>Aha, de mi köze van a játékfejlesztéshez?</b></div><div class="separator" style="clear: both; text-align: left;">Játékokat általánosságban elég jól elkülöníthető állapotokra lehet bontani. Gondoljunk csak arra, ahogy egy egyszerű webes játék felépül. Először fogad minket a töltési képernyő aztán következik a menü, ahol eldönthetjük merre tovább. Nem is beszélve, hogy maga a játékmenet is több szintből épülhet fel.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Ezek mind állapotnak tekinthetőek, ahol a kezdő állapot a betöltési képernyő, ahonnan végül tovább lehet jutni többi állapotba.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><b><span style="font-size: large;">Stream</span></b><div>Aki már csinált valaha aszinkron programozást annak ismerős lehet a Stream fogalma. Stream magyarul folyamot jelent, viszont a mi esetünkben adatfolyamnak fordítanám le, mivel gyakorlatilag az a lényege, hogy adatot továbbítson folyamatosan. Mi pedig tudjuk fogni ezt az adatfolyamatot és megkapjuk belőle azokat az adatokat, amiket éppen továbbit.</div><div>Stream-eknek még van egy nagyon jó tulajdonsága, hogy bármikor meg lehet állítani és folytatni őket.</div><div>Nem is beszélve arról, hogy nagyon könnyű velük kommunikálni.</div><div><br /></div><div><b>Na ennek meg mi köze van az állapotgéphez?</b></div><div>Valóságban nincs túl sok közük egymáshoz, viszont mégis érdemes vegyíteni őket , mert meglepően sokat tudó rendszert lehet csinálni vele minimális kód megírásával.</div><div><br /></div><div>Mi esetünkben egy Stream egyelő lesz egy állapottal. Tehát van máris egy állapotunk, amivel tudunk kommunikálni és akkor indítjuk el vagy állítjuk meg amikor csak akarjuk.</div><div>A valóságban csak annyi dolgunk volt, hogy az állapot(State) osztállyal örököltettük a Stream osztályt és innentől kezdve csak ki kellet egészíteni, hogy tényleg úgy viselkedjen, mint egy állapot.</div><div><br /></div><div><br /></div><b><span style="font-size: large;">Állapotok kezelése  </span></b><div>Eddig vannak az állapotaink, de ki tárolja el ezeket az állapotokat és vajon ki indítja el a kezdő állapotot vagy egyáltalán melyik a kezdő állapot?Nem is beszélve, hogy hogyan fogunk állapotokat váltani?</div><div><br /></div><div>Kérdések megválaszolására kell csinálnunk egy állapot menedzsert, aminek egyetlen dolga, hogy ezeket a problémákat megoldja.</div><div><br /></div><div>Tárolás mondja egy szimpla asszociatív tömb, amiben a kulcs neve az állapot neve és a kulcshoz tartozó érték pedig egy állapot.</div><div><br /></div><div>Kezdő állapot definiálás és indítás elég könnyű, mivel csak meg kell adni, hogy melyik állapotot kezdje el hallgatni.(Ugyebár az állapot egy Stream)</div><div><br /></div><div>Az állapot váltásnál tudnunk kell, hogy melyik állapot következik. Én ezt úgy oldottam meg hogy éppen aktuális állapot tárolja a következő állapot nevét. Név tudatában pedig tudjuk, hogy melyik állapotot hallgassuk meg következőként, viszont előtte még az aktuális állapotot kell megállítanunk.</div><div><br /></div><div><br /></div><div><b><span style="font-size: large;">Állapotok&nbsp;</span></b><span style="font-size: large;"><b>megvalósítása</b></span></div><div>Az állapotgép csak akkor működik, ha vannak olyan egyéni állapotok, amik öröklik azt az absztrakt állapot osztályt, amit csináltunk és megvalósítják annak az összes absztrakt metódusát.</div><div>Az én esetemben csak a create metódus megvalósítását várom el a programozótól.</div><div><br /></div><div><b>Magyarázat</b></div><div>Az absztrakt metódus azt jelenti, hogy nincsen megvalósítása.&nbsp;</div><div>Az absztrakt osztály pedig azt jelenti, hogy tartalmaz legalább 1 absztrakt metódust és az osztály nem példányosítható.</div><div><br /></div><div><br /></div><b><span style="font-size: large;">Összegezve</span></b><div>Megéri az állapotokat streamelni, mivel valamennyire egyszerű a megvalósítás és nagyon sok lehetőség rejlik benne. Én személy szerint a kommunikációs készségében látom a legnagyobb lehetőséget, amit jó magam még alig használtam ki.</div><div><br /></div><div>Ha kódot is szeretnétek látni ajánlhatom a játék motorom <a href="https://github.com/StrykerKKD/dartrocket/blob/master/lib/src/core/state.dart">Állapot</a> és <a href="https://github.com/StrykerKKD/dartrocket/blob/master/lib/src/core/statemanager.dart">Állapot menedzser</a> osztályát.&nbsp;</div></div>